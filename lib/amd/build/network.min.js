define ("core/network",["jquery","core/ajax","core/config","core/notification","core/str"],function(a,b,c,d,e){var f=!1,g=!1,h=0,i=0,j=!1,k=!1,l=1e3*Math.min(c.sessiontimeout/10,600),m=0<c.sessiontimeoutwarning?1e3*c.sessiontimeoutwarning:2*l,n=function(a){k=!0;g=!1;o(a);p()},o=function(a){a.hide();a.destroy()},p=function(){return b.call([{methodname:"core_session_time_remaining",args:{}}],!0,!0,!0)[0].then(function(a){if(1e3*a.timeremaining>m){return!1}else{return e.get_strings([{key:"sessionexpired",component:"error"},{key:"sessionerroruser",component:"error"},{key:"loginagain",component:"moodle"},{key:"cancel",component:"moodle"}]).then(function(a){d.confirm(a[0],a[1],a[2],a[3],function(){location.reload();return!0});return!0}).fail(d.exception)}})},q=function(){if(k){return p()}else{return b.call([{methodname:"core_session_touch",args:{}}],!0,!0,!1,i)[0].then(function(){if(0<h){setTimeout(q,h)}return!0}).fail(function(){d.alert("",j)})}},r=function(){k=!1;return b.call([{methodname:"core_session_time_remaining",args:{}}],!0,!0,!0)[0].then(function(a){if(0>=a.userid){return!1}if(0>a.timeremaining){return p()}else if(1e3*a.timeremaining<m&&!g){g=!0;e.get_strings([{key:"norecentactivity",component:"moodle"},{key:"sessiontimeoutsoon",component:"moodle"},{key:"extendsession",component:"moodle"},{key:"cancel",component:"moodle"}]).then(function(a){return d.confirm(a[0],a[1],a[2],a[3],function(){q();g=!1;setTimeout(r,5*l);return!0},function(){setTimeout(r,l)})}).then(function(b){setTimeout(n,1e3*a.timeremaining,b)}).fail(d.exception)}else{setTimeout(r,l)}return!0})},s=function(){if(0<h){setTimeout(q,h)}else{setTimeout(r,5*l)}},t=function(){if(f){return}f=!0;s()},u=function(a,b,c){if(f){return}f=!0;h=1e3*a;j=c;i=1e3*b;s()};return{keepalive:u,init:t}});
//# sourceMappingURL=network.min.js.map
